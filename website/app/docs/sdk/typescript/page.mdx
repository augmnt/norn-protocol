export const metadata = {
  title: "TypeScript SDK",
};

# TypeScript SDK

The `@norn-protocol/sdk` package provides wallet primitives, transaction builders, an RPC client, and WebSocket subscription helpers for building TypeScript/JavaScript applications on Norn.

## Installation

```bash
npm install @norn-protocol/sdk
```

Or build from source:

```bash
cd sdk/typescript
npm install
npm run build
```

## Wallet

The `Wallet` class manages Ed25519 key pairs and BIP-39 mnemonics.

```typescript
import { Wallet } from "@norn-protocol/sdk";

// Generate a new wallet with a random mnemonic
const wallet = Wallet.generate();
console.log(wallet.address);    // "0x..." (20-byte hex)
console.log(wallet.mnemonic);   // 12-word BIP-39 phrase

// Restore from a private key
const wallet2 = Wallet.fromPrivateKey("abcd1234...");

// Restore from a mnemonic
const wallet3 = Wallet.fromMnemonic("word1 word2 ...");
```

## NornClient

The `NornClient` class provides RPC methods for reading chain state and submitting transactions.

```typescript
import { NornClient } from "@norn-protocol/sdk";

const client = new NornClient("https://seed.norn.network");
```

### Read-Only Methods

```typescript
// Get balance
const balance = await client.getBalance("0x...");

// Get block by height
const block = await client.getBlock(42);

// Get latest block
const latest = await client.getLatestBlock();

// Get weave state
const state = await client.getWeaveState();

// Get account info (thread, names, balances)
const info = await client.getThreadInfo("0x...");

// Resolve a NornName
const resolved = await client.resolveName("alice");

// Get token info
const token = await client.getTokenBySymbol("MTK");

// List tokens
const tokens = await client.listTokens(10, 0);

// Get loom info
const loom = await client.getLoomInfo("0x...");

// Get node health
const health = await client.getHealth();
```

### Mutation Methods

Mutation methods require a signed transaction (hex-encoded borsh):

```typescript
// Submit a transfer
const result = await client.submitTransfer(signedTransferHex);

// Register a name
const result = await client.registerName(signedNameHex);

// Create a token
const result = await client.createToken(signedTokenDefHex);
```

## Transaction Builders

Build and sign transactions using the builder functions:

```typescript
import {
  Wallet,
  NornClient,
  buildTransfer,
  buildNameRegistration,
  buildTokenDefinition,
  buildTokenMint,
  buildTokenBurn,
  parseAmount,
  formatAmount,
} from "@norn-protocol/sdk";

const wallet = Wallet.fromPrivateKey("...");
const client = new NornClient("https://seed.norn.network");

// Build a transfer
const transferHex = await buildTransfer(wallet, {
  to: "0xrecipient...",
  amount: parseAmount("10.5", 18),
});
await client.submitTransfer(transferHex);

// Register a NornName
const nameHex = await buildNameRegistration(wallet, { name: "alice" });
await client.registerName(nameHex);

// Create a token
const tokenHex = await buildTokenDefinition(wallet, {
  name: "My Token",
  symbol: "MTK",
  decimals: 8,
  maxSupply: 1000000n,
  initialSupply: 1000n,
});
await client.createToken(tokenHex);

// Mint tokens
const mintHex = await buildTokenMint(wallet, {
  tokenId: "0x...",
  to: "0xrecipient...",
  amount: 500n,
});
await client.mintToken(mintHex);

// Burn tokens
const burnHex = await buildTokenBurn(wallet, {
  tokenId: "0x...",
  amount: 100n,
});
await client.burnToken(burnHex);
```

## WebSocket Subscriptions

Subscribe to real-time events:

```typescript
import {
  subscribeNewBlocks,
  subscribeTransfers,
  subscribeTokenEvents,
  subscribeLoomEvents,
  subscribePendingTransactions,
} from "@norn-protocol/sdk";

// Subscribe to new blocks
const blockSub = subscribeNewBlocks("wss://seed.norn.network", (block) => {
  console.log("New block:", block.height);
});

// Subscribe to transfers
const transferSub = subscribeTransfers("wss://seed.norn.network", (tx) => {
  console.log("Transfer:", tx.from, "->", tx.to, tx.amount);
});

// Subscribe to token events
const tokenSub = subscribeTokenEvents("wss://seed.norn.network", (event) => {
  console.log("Token event:", event);
});

// Unsubscribe when done
blockSub.unsubscribe();
transferSub.unsubscribe();
```

## Exports

The SDK exports the following:

### Functions
- `blake3Hash`, `ed25519Sign`, `ed25519Verify`
- `publicKeyFromPrivate`, `publicKeyToAddress`
- `toHex`, `fromHex`, `addressToHex`, `hexToAddress`
- `buildTransfer`, `buildNameRegistration`, `buildTokenDefinition`, `buildTokenMint`, `buildTokenBurn`
- `parseAmount`, `formatAmount`
- `subscribeNewBlocks`, `subscribeTransfers`, `subscribeTokenEvents`, `subscribeLoomEvents`, `subscribePendingTransactions`

### Classes
- `Wallet` -- Key management
- `NornClient` -- RPC client
- `Subscription` -- WebSocket subscription handle
- `BorshWriter`, `BorshReader` -- Borsh serialization helpers
